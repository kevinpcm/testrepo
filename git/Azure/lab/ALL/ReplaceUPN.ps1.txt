# Here is how to change UPN suffix by OU:

Import-Module ActiveDirectory
$oldSuffix = " pyrotek-inc.com "
$newSuffix = " pyrotek.com "
$ou = "DC=CONTOSO,DC=LOCAL"
$server = "ADOMAINCONTROLLER"
Get-ADUser -SearchBase $ou -filter * | ForEach-Object {
$newUpn = $_.UserPrincipalName.Replace($oldSuffix,$newSuffix)
$_ | Set-ADUser -server $server -UserPrincipalName $newUpn
}

# This is via CSV:

$oldSuffix = 'existingupn.com'
$newSuffix = 'newupn.com'
Import-CSV userlist.csv | ForEach-Object {
$usr = get-aduser $_.loginid |Select-Object userprincipalname, samaccountname
$newUpn = $usr.UserPrincipalName.Replace($oldSuffix,$newSuffix)
Set-ADUser -identity $usr.samaccountname -UserPrincipalName $newUpn -Verbose
}
